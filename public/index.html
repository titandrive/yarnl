<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Yarnl - Crochet Project Manager</title>
    <script>
        // Set theme immediately to prevent flash
        const theme = localStorage.getItem('theme') || 'dark';
        document.documentElement.setAttribute('data-theme', theme);
        // Set mascot immediately to prevent flash
        const savedMascot = localStorage.getItem('selectedMascot');
        if (savedMascot) {
            document.write('<link rel="icon" type="image/png" sizes="128x128" href="' + savedMascot + '">');
        } else {
            document.write('<link rel="icon" type="image/png" sizes="128x128" href="mascots/default.png">');
        }
    </script>
    <link rel="stylesheet" href="styles.css?v=48">
</head>
<body>
    <div class="container">
        <header>
            <div class="header-btn-container header-left">
                <button id="settings-btn" class="header-btn header-btn-labeled" aria-label="Settings">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="12" cy="12" r="3"></circle>
                        <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
                    </svg>
                    <span>Settings</span>
                </button>
                <button id="header-theme-toggle" class="header-btn header-theme-toggle" aria-label="Toggle dark mode" title="Toggle dark mode">
                    <svg class="sun-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                    <svg class="moon-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                </button>
            </div>
            <div class="header-title">
                <h1>Yarnl<span id="header-logo"><img id="header-mascot-img" alt="Yarnl mascot" style="height: 2.59em; vertical-align: middle; margin-left: 0.3em;"><script>document.getElementById('header-mascot-img').src = localStorage.getItem('selectedMascot') || 'mascots/default.png';</script></span></h1>
                <p class="subtitle" id="header-tagline">Your self-hosted crochet companion</p>
            </div>
            <div class="header-btn-container header-right">
                <button id="add-pattern-btn" class="header-btn header-btn-labeled" aria-label="Add pattern">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="12" y1="5" x2="12" y2="19"></line>
                        <line x1="5" y1="12" x2="19" y2="12"></line>
                    </svg>
                    <span>New Pattern</span>
                </button>
                <div id="add-menu" class="add-menu" style="display: none;">
                    <button class="add-menu-item" id="add-upload-pdf">PDF</button>
                    <button class="add-menu-item" id="add-new-pattern">Markdown</button>
                </div>
            </div>
        </header>

        <nav class="tabs">
            <button class="tab-btn active" data-tab="current">Current<span class="tab-count" id="current-tab-count"></span></button>
            <button class="tab-btn" data-tab="library">Library<span class="tab-count" id="library-tab-count"></span></button>
        </nav>

        <!-- Current Patterns Tab -->
        <div id="current" class="tab-content active">
            <div class="current-patterns-container">
                <div id="current-patterns-grid" class="patterns-grid">
                    <p class="empty-state">You don't have any active patterns. Time to start crocheting!</p>
                </div>
            </div>
        </div>

        <!-- Pattern Library Tab -->
        <div id="library" class="tab-content">
            <div class="patterns-container">
                <div class="library-layout">
                    <aside class="library-sidebar">
                        <div class="sidebar-section">
                            <label for="search-input">Search</label>
                            <div class="search-input-wrapper">
                                <input type="text" id="search-input" placeholder="Search patterns...">
                                <button type="button" id="search-clear-btn" class="search-clear-btn" title="Clear search">
                                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <line x1="18" y1="6" x2="6" y2="18"></line>
                                        <line x1="6" y1="6" x2="18" y2="18"></line>
                                    </svg>
                                </button>
                            </div>
                        </div>
                        <div class="sidebar-section">
                            <label for="show-filter-select">Show</label>
                            <select id="show-filter-select">
                                <option value="all">All Patterns</option>
                                <option value="favorites">Favorites Only</option>
                                <option value="current">Current Only</option>
                                <option value="new">New Only</option>
                            </select>
                        </div>
                        <div class="sidebar-section">
                            <label for="category-filter-select">Category</label>
                            <select id="category-filter-select">
                                <option value="all">All Categories</option>
                            </select>
                        </div>
                        <div class="sidebar-section">
                            <div class="sort-header">
                                <label for="sort-select">Sort by</label>
                                <div class="pin-buttons">
                                    <button id="pin-current" class="pin-btn" title="Pin current patterns to top">
                                        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <polygon points="5 3 19 12 5 21 5 3"></polygon>
                                        </svg>
                                    </button>
                                    <button id="pin-favorites" class="pin-btn" title="Pin favorites to top">
                                        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
                                        </svg>
                                    </button>
                                </div>
                            </div>
                            <select id="sort-select">
                                <option value="date-desc">Date (Newest)</option>
                                <option value="date-asc">Date (Oldest)</option>
                                <option value="name-asc">Name (A-Z)</option>
                                <option value="name-desc">Name (Z-A)</option>
                            </select>
                        </div>
                        <div class="sidebar-section">
                            <label>Status</label>
                            <div class="sidebar-toggle-row">
                                <span>Completed</span>
                                <label class="toggle-switch small">
                                    <input type="checkbox" id="show-completed" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            <div class="sidebar-toggle-row">
                                <span>Current</span>
                                <label class="toggle-switch small">
                                    <input type="checkbox" id="show-current" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                        <div class="sidebar-section">
                            <label>Type</label>
                            <div class="sidebar-toggle-row">
                                <span>PDF</span>
                                <label class="toggle-switch small">
                                    <input type="checkbox" id="show-pdf" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            <div class="sidebar-toggle-row">
                                <span>Markdown</span>
                                <label class="toggle-switch small">
                                    <input type="checkbox" id="show-markdown" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                        <div class="sidebar-section">
                            <label>Highlight</label>
                            <select id="highlight-select" class="sidebar-select">
                                <option value="none">None</option>
                                <option value="favorites">Favorites</option>
                                <option value="current">Current</option>
                                <option value="new">New Patterns</option>
                            </select>
                        </div>
                    </aside>
                    <div id="patterns-grid" class="patterns-grid">
                        <p class="empty-state">No patterns yet. Upload your first pattern!</p>
                    </div>
                </div>
            </div>

            <!-- Upload Panel (hidden until needed) -->
            <div id="upload-panel" class="upload-panel" style="display: none;">
                <div class="upload-panel-header">
                    <button id="close-upload-panel" class="btn btn-secondary">‚Üê Back</button>
                    <h3>Upload Patterns</h3>
                </div>
                <div class="upload-container">
                    <div id="drop-zone" class="drop-zone">
                        <div class="drop-zone-content">
                            <span class="drop-zone-icon">üìÑ</span>
                            <p class="drop-zone-text">Drag & drop PDF files here or click to browse</p>
                            <p class="drop-zone-subtext">You can select multiple files at once</p>
                            <input type="file" id="file-input" accept=".pdf" multiple hidden>
                            <button type="button" id="browse-btn" class="btn btn-secondary">Browse Files</button>
                        </div>
                    </div>

                    <!-- Staging Area -->
                    <div id="staging-area" class="staging-area" style="display: none;">
                        <div class="staging-header">
                            <h3>Staged Files (<span id="staged-count">0</span>)</h3>
                            <div class="staging-actions">
                                <button type="button" id="upload-all-btn" class="btn btn-primary">Upload All</button>
                                <button type="button" id="clear-all-btn" class="btn btn-secondary">Clear All</button>
                            </div>
                        </div>
                        <div id="staged-files-list" class="staged-files-list">
                            <!-- Staged files will be added here -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- New Pattern Panel (for markdown patterns) -->
            <div id="new-pattern-panel" class="new-pattern-panel" style="display: none;">
                <div class="new-pattern-header">
                    <button id="close-new-pattern-panel" class="btn btn-secondary">‚Üê Back</button>
                    <h3>Create New Pattern</h3>
                </div>
                <div class="new-pattern-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="new-pattern-name">Name <span class="required">required</span></label>
                            <input type="text" id="new-pattern-name" required placeholder="Enter pattern name">
                        </div>
                        <div class="form-group">
                            <label>Category <span class="required">required</span></label>
                            <div id="new-pattern-category-container">
                                <!-- Category dropdown will be populated dynamically -->
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="new-pattern-description">Description <span class="char-counter"><span id="new-desc-count">0</span>/45</span></label>
                        <input type="text" id="new-pattern-description" placeholder="Brief description (optional)" maxlength="45" oninput="document.getElementById('new-desc-count').textContent = this.value.length">
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Hashtags <span class="required">optional</span></label>
                            <div id="new-pattern-hashtags-container">
                                <!-- Hashtag selector will be populated dynamically -->
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Thumbnail <span class="required">optional</span></label>
                            <div class="thumbnail-selector" id="new-pattern-thumbnail-selector" data-target="new-pattern">
                                <div class="thumbnail-selector-preview" id="new-pattern-thumbnail-preview">
                                    <span class="thumbnail-selector-placeholder">+</span>
                                </div>
                            </div>
                            <small class="form-hint">Click to select or paste an image</small>
                        </div>
                    </div>
                    <div class="form-group new-pattern-content-group">
                        <div class="new-pattern-content-header">
                            <label>Pattern Content <span class="required">markdown</span></label>
                            <div class="new-pattern-tabs">
                                <button type="button" class="new-pattern-tab active" data-tab="edit">Edit</button>
                                <button type="button" class="new-pattern-tab" data-tab="preview">Preview</button>
                                <label class="new-pattern-live-preview-label">
                                    <input type="checkbox" id="new-pattern-live-preview">
                                    <span>Live preview</span>
                                </label>
                            </div>
                        </div>
                        <div class="new-pattern-editor-wrapper">
                            <textarea id="new-pattern-content" placeholder="Write your pattern here... Markdown supported!

Example:
# My Pattern

## Materials
- Yarn: Worsted weight
- Hook: 5mm

## Instructions
### Round 1
6 sc in magic ring (6)

### Round 2
Inc in each st around (12)
"></textarea>
                            <div id="new-pattern-preview" class="new-pattern-preview"></div>
                        </div>
                    </div>
                    <div class="new-pattern-actions">
                        <div class="mark-current-toggle">
                            <span class="mark-current-label">Mark as current pattern</span>
                            <label class="toggle-switch">
                                <input type="checkbox" id="new-pattern-is-current">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <button type="button" id="cancel-new-pattern" class="btn btn-secondary">Cancel</button>
                        <button type="button" id="save-new-pattern" class="btn btn-primary">Create Pattern</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Settings Tab -->
        <div id="settings" class="tab-content">
            <div class="settings-layout">
                <!-- Settings Sidebar -->
                <nav class="settings-sidebar">
                    <div class="settings-search-wrapper">
                        <svg class="settings-search-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="11" cy="11" r="8"></circle>
                            <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                        </svg>
                        <input type="text" id="settings-search-input" placeholder="Search settings...">
                        <button type="button" id="settings-search-clear" class="settings-search-clear" title="Clear search">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <line x1="18" y1="6" x2="6" y2="18"></line>
                                <line x1="6" y1="6" x2="18" y2="18"></line>
                            </svg>
                        </button>
                    </div>
                    <button class="settings-nav-btn active" data-section="appearance">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="12" cy="12" r="3"></circle>
                            <path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"></path>
                        </svg>
                        <span>Appearance</span>
                    </button>
                    <button class="settings-nav-btn" data-section="categories">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M4 4h6v6H4zM14 4h6v6h-6zM4 14h6v6H4zM14 14h6v6h-6z"></path>
                        </svg>
                        <span>Categories & Tags</span>
                    </button>
                    <button class="settings-nav-btn" data-section="shortcuts">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <rect x="2" y="4" width="20" height="16" rx="2"></rect>
                            <path d="M6 8h.01M10 8h.01M14 8h.01M18 8h.01M6 12h.01M10 12h.01M14 12h.01M18 12h.01M8 16h8"></path>
                        </svg>
                        <span>Keyboard Shortcuts</span>
                    </button>
                    <button class="settings-nav-btn" data-section="backup">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                            <polyline points="17 8 12 3 7 8"></polyline>
                            <line x1="12" y1="3" x2="12" y2="15"></line>
                        </svg>
                        <span>Backup & Restore</span>
                    </button>
                    <button class="settings-nav-btn" data-section="storage">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <ellipse cx="12" cy="5" rx="9" ry="3"></ellipse>
                            <path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"></path>
                            <path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"></path>
                        </svg>
                        <span>Storage</span>
                    </button>
                    <button class="settings-nav-btn" data-section="notifications">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path>
                            <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
                        </svg>
                        <span>Notifications</span>
                    </button>
                    <button class="settings-nav-btn" data-section="about">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="12" cy="12" r="10"></circle>
                            <line x1="12" y1="16" x2="12" y2="12"></line>
                            <line x1="12" y1="8" x2="12.01" y2="8"></line>
                        </svg>
                        <span>About</span>
                    </button>
                    <button class="settings-nav-btn" data-section="archive">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <polyline points="21 8 21 21 3 21 3 8"></polyline>
                            <rect x="1" y="3" width="22" height="5"></rect>
                            <line x1="10" y1="12" x2="14" y2="12"></line>
                        </svg>
                        <span>Archive</span>
                    </button>
                </nav>

                <!-- Settings Content -->
                <div class="settings-content">
                    <!-- No Results Message -->
                    <div class="settings-no-results" id="settings-no-results">
                        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="11" cy="11" r="8"></circle>
                            <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                        </svg>
                        <p>No settings found matching your search</p>
                    </div>
                    <!-- Appearance Section -->
                    <section class="settings-section active" data-section="appearance">
                        <h3>Appearance</h3>
                        <p class="section-description">Customize the look and feel of your app</p>

                        <h4 class="settings-subheading">Theme</h4>
                        <div class="setting-item">
                            <div class="setting-info">
                                <label>Color Theme</label>
                                <p class="setting-description">Choose a color scheme</p>
                            </div>
                            <select id="theme-select" class="settings-select">
                                <option value="lavender">Lavender</option>
                                <option value="ocean">Ocean</option>
                                <option value="forest">Forest</option>
                                <option value="sunset">Sunset</option>
                                <option value="rose">Rose</option>
                                <option value="slate">Slate</option>
                                <option value="aqua">Aqua</option>
                                <option value="midnight">Midnight</option>
                                <option value="razer">Razer</option>
                                <option value="synthwave">Synthwave</option>
                                <option value="cyberpunk">Cyberpunk</option>
                                <option value="dracula">Dracula</option>
                                <option value="coffee">Coffee</option>
                                <option value="nasa">NASA</option>
                                <option value="minimal">Minimal</option>
                                <option value="halloween">Halloween</option>
                            </select>
                        </div>
                        <div class="setting-item">
                            <div class="setting-info">
                                <label>Party Mode</label>
                                <p class="setting-description">Random theme & font combo</p>
                            </div>
                            <button id="party-mode-btn" class="party-mode-btn" title="Randomize theme and font">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
                                </svg>
                                Surprise Me!
                            </button>
                        </div>
                        <div class="setting-item">
                            <div class="setting-info">
                                <label>Day / Night Mode</label>
                                <p class="setting-description">Switch between light and dark</p>
                            </div>
                            <div class="day-night-toggle">
                                <button type="button" id="day-mode-btn" class="mode-btn" title="Day Mode">
                                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <circle cx="12" cy="12" r="5"/>
                                        <path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/>
                                    </svg>
                                </button>
                                <button type="button" id="night-mode-btn" class="mode-btn" title="Night Mode">
                                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
                                    </svg>
                                </button>
                            </div>
                        </div>
                        <div class="setting-item">
                            <div class="setting-info">
                                <label>Auto Switch</label>
                                <p class="setting-description">Automatically change mode</p>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="auto-mode-checkbox">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <div class="setting-item" id="auto-type-container" style="display: none;">
                            <div class="setting-info">
                                <label>Auto Type</label>
                                <p class="setting-description">System preference or scheduled</p>
                            </div>
                            <select id="auto-type-select" class="settings-select">
                                <option value="system">System</option>
                                <option value="scheduled">Scheduled</option>
                            </select>
                        </div>
                        <div class="setting-item" id="schedule-times-container" style="display: none;">
                            <div class="setting-info">
                                <label>Schedule Times</label>
                                <p class="setting-description">Day starts / Night starts</p>
                            </div>
                            <div class="schedule-times">
                                <input type="time" id="day-start-time" value="07:00">
                                <span class="schedule-separator">/</span>
                                <input type="time" id="night-start-time" value="19:00">
                            </div>
                        </div>

                        <h4 class="settings-subheading">Font</h4>
                        <div class="setting-item">
                            <div class="setting-info">
                                <label>Font Family</label>
                                <p class="setting-description">Choose your preferred font</p>
                            </div>
                            <select id="font-select" class="settings-select">
                                <option value="JetBrains Mono">JetBrains Mono (Default)</option>
                                <option value="Inter">Inter</option>
                                <option value="Roboto">Roboto</option>
                                <option value="Open Sans">Open Sans</option>
                                <option value="Lato">Lato</option>
                                <option value="Poppins">Poppins</option>
                                <option value="Nunito">Nunito</option>
                                <option value="Raleway">Raleway</option>
                                <option value="Source Sans Pro">Source Sans Pro</option>
                                <option value="Ubuntu">Ubuntu</option>
                                <option value="Fira Sans">Fira Sans</option>
                                <option value="custom">Custom...</option>
                            </select>
                        </div>
                        <div class="setting-item" id="custom-font-container" style="display: none;">
                            <div class="setting-info">
                                <label>Google Font name</label>
                                <p class="setting-description">Enter exact name from <a href="https://fonts.google.com" target="_blank">Google Fonts</a></p>
                            </div>
                            <div class="custom-font-input-row">
                                <input type="text" id="custom-font-input" class="settings-input" placeholder="e.g., Lato, Raleway, etc.">
                                <button id="apply-custom-font-btn" class="btn btn-primary">Apply</button>
                            </div>
                        </div>

                        <h4 class="settings-subheading">Header</h4>
                        <div class="setting-item">
                            <div class="setting-info">
                                <label>Gradient Header</label>
                                <p class="setting-description">Use gradient colors</p>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="gradient-checkbox">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <div class="setting-item">
                            <div class="setting-info">
                                <label>Theme Toggle</label>
                                <p class="setting-description">Show day/night button in header</p>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="show-header-theme-toggle-checkbox" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <div class="setting-item">
                            <div class="setting-info">
                                <label>Show Logo</label>
                                <p class="setting-description">Display mascot in header</p>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="show-logo-checkbox" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <div class="setting-item" id="mascot-selector-container">
                            <div class="setting-info">
                                <label>Mascot</label>
                                <p class="setting-description">Choose header mascot</p>
                            </div>
                            <button id="mascot-select-btn" class="settings-select"><span id="current-mascot-name">Default</span></button>
                        </div>
                        <div class="setting-item">
                            <div class="setting-info">
                                <label>Theme Mascot</label>
                                <p class="setting-description">Use matching mascot for theme</p>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="theme-mascot-checkbox">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <div class="setting-item">
                            <div class="setting-info">
                                <label>Show Tagline</label>
                                <p class="setting-description">Display subtitle text</p>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="show-tagline-checkbox" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <div class="setting-item" id="tagline-input-container">
                            <div class="setting-info">
                                <label>Tagline Text</label>
                                <p class="setting-description">Customize subtitle</p>
                            </div>
                            <input type="text" id="tagline-input" class="settings-input" placeholder="Your self-hosted crochet companion">
                        </div>

                        <h4 class="settings-subheading">Library</h4>
                        <div class="setting-item">
                            <div class="setting-info">
                                <label>Default Page</label>
                                <p class="setting-description">Page shown on startup</p>
                            </div>
                            <select id="default-page-select" class="settings-select">
                                <option value="current">Current</option>
                                <option value="library">Library</option>
                            </select>
                        </div>
                        <div class="setting-item">
                            <div class="setting-info">
                                <label>Tab Counts</label>
                                <p class="setting-description">Show pattern counts on tabs</p>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="tab-counts-checkbox" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <div class="setting-item">
                            <div class="setting-info">
                                <label>Auto-Current on Timer</label>
                                <p class="setting-description">Mark pattern as current when timer starts</p>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="auto-current-timer-checkbox">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>

                        <h4 class="settings-subheading">Badge Visibility</h4>
                        <div class="setting-item">
                            <div class="setting-info">
                                <label>Type Badge</label>
                                <p class="setting-description">Show PDF/MD on cards</p>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="badge-type-checkbox" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <div class="setting-item">
                            <div class="setting-info">
                                <label>Status Badge</label>
                                <p class="setting-description">Show CURRENT/COMPLETE on cards</p>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="badge-status-checkbox" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <div class="setting-item">
                            <div class="setting-info">
                                <label>Category Badge</label>
                                <p class="setting-description">Show category on cards</p>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="badge-category-checkbox" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <div class="setting-item">
                            <div class="setting-info">
                                <label>Star Badge</label>
                                <p class="setting-description">Show star on favorite cards</p>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="badge-star-checkbox" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>

                        <h4 class="settings-subheading">Pattern Viewer</h4>
                        <div class="setting-item">
                            <div class="setting-info">
                                <label>Default Zoom</label>
                                <p class="setting-description">Initial zoom level for PDFs</p>
                            </div>
                            <select id="default-zoom-select" class="settings-select">
                                <option value="fit">Fit Page</option>
                                <option value="fit-width">Fit Width</option>
                                <option value="25">25%</option>
                                <option value="50">50%</option>
                                <option value="75">75%</option>
                                <option value="100">100%</option>
                                <option value="125">125%</option>
                                <option value="150">150%</option>
                                <option value="175">175%</option>
                                <option value="200">200%</option>
                            </select>
                        </div>
                        <div class="setting-item">
                            <div class="setting-info">
                                <label>Auto Timer</label>
                                <p class="setting-description">Enable auto timer by default</p>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="auto-timer-default-checkbox">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>

                        <div class="settings-reset">
                            <button id="reset-appearance-btn" class="btn btn-secondary">Reset to Defaults</button>
                        </div>
                    </section>

                    <!-- Categories & Tags Section -->
                    <section class="settings-section" data-section="categories">
                        <h3>Categories & Tags</h3>
                        <p class="section-description">Organize your pattern library</p>

                        <h4 class="settings-subheading">Categories</h4>
                        <div class="categories-list" id="categories-list">
                            <!-- Categories will be populated here -->
                        </div>
                        <div class="add-category-form">
                            <input type="text" id="new-category-input" placeholder="New category name...">
                            <button id="add-category-btn" class="btn btn-primary">Add</button>
                        </div>

                        <h4 class="settings-subheading">Hashtags</h4>
                        <div class="hashtags-list" id="hashtags-list">
                            <!-- Hashtags will be populated here -->
                        </div>
                        <div class="add-hashtag-form">
                            <input type="text" id="new-hashtag-input" placeholder="New hashtag...">
                            <button id="add-hashtag-btn" class="btn btn-primary">Add</button>
                        </div>
                    </section>

                    <!-- Keyboard Shortcuts Section -->
                    <section class="settings-section" data-section="shortcuts">
                        <h3>Keyboard Shortcuts</h3>
                        <p class="section-description">Customize keyboard shortcuts for the PDF viewer. Click a key to change it.</p>

                        <div class="setting-item">
                            <div class="setting-info">
                                <label for="media-remote-enabled">Bluetooth/Media Remote</label>
                                <p class="setting-description">Enable to use media keys (play/pause, next, prev) from a Bluetooth remote. Requires Yarnl to be the active media app.</p>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="media-remote-enabled">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <div class="setting-item shortcut-item">
                            <div class="setting-info">
                                <label>Increase Counter</label>
                                <p class="setting-description">Add one to selected counter</p>
                            </div>
                            <div class="shortcut-keys">
                                <button class="shortcut-key-btn" data-shortcut="counterIncrease" data-index="0" title="Click to change">‚Üë</button>
                                <button class="shortcut-key-btn shortcut-alt" data-shortcut="counterIncrease" data-index="1" title="Click to add alternate key"></button>
                            </div>
                        </div>
                        <div class="setting-item shortcut-item">
                            <div class="setting-info">
                                <label>Decrease Counter</label>
                                <p class="setting-description">Subtract one from selected counter</p>
                            </div>
                            <div class="shortcut-keys">
                                <button class="shortcut-key-btn" data-shortcut="counterDecrease" data-index="0" title="Click to change">‚Üì</button>
                                <button class="shortcut-key-btn shortcut-alt" data-shortcut="counterDecrease" data-index="1" title="Click to add alternate key"></button>
                            </div>
                        </div>
                        <div class="setting-item shortcut-item">
                            <div class="setting-info">
                                <label>Previous Page</label>
                                <p class="setting-description">Go back one page</p>
                            </div>
                            <div class="shortcut-keys">
                                <button class="shortcut-key-btn" data-shortcut="prevPage" data-index="0" title="Click to change">‚Üê</button>
                                <button class="shortcut-key-btn shortcut-alt" data-shortcut="prevPage" data-index="1" title="Click to add alternate key"></button>
                            </div>
                        </div>
                        <div class="setting-item shortcut-item">
                            <div class="setting-info">
                                <label>Next Page</label>
                                <p class="setting-description">Go forward one page</p>
                            </div>
                            <div class="shortcut-keys">
                                <button class="shortcut-key-btn" data-shortcut="nextPage" data-index="0" title="Click to change">‚Üí</button>
                                <button class="shortcut-key-btn shortcut-alt" data-shortcut="nextPage" data-index="1" title="Click to add alternate key"></button>
                            </div>
                        </div>
                        <div class="setting-item shortcut-item">
                            <div class="setting-info">
                                <label>Start/Stop Timer</label>
                                <p class="setting-description">Toggle project timer</p>
                            </div>
                            <div class="shortcut-keys">
                                <button class="shortcut-key-btn" data-shortcut="toggleTimer" data-index="0" title="Click to change">Space</button>
                                <button class="shortcut-key-btn shortcut-alt" data-shortcut="toggleTimer" data-index="1" title="Click to add alternate key"></button>
                            </div>
                        </div>
                        <div class="setting-item shortcut-item">
                            <div class="setting-info">
                                <label>Next Counter</label>
                                <p class="setting-description">Cycle to next counter</p>
                            </div>
                            <div class="shortcut-keys">
                                <button class="shortcut-key-btn" data-shortcut="nextCounter" data-index="0" title="Click to change">Tab</button>
                                <button class="shortcut-key-btn shortcut-alt" data-shortcut="nextCounter" data-index="1" title="Click to add alternate key"></button>
                            </div>
                        </div>
                        <div class="setting-item shortcut-item">
                            <div class="setting-info">
                                <label>Zoom In</label>
                                <p class="setting-description">Increase PDF zoom</p>
                            </div>
                            <div class="shortcut-keys">
                                <button class="shortcut-key-btn" data-shortcut="zoomIn" data-index="0" title="Click to change">+</button>
                                <button class="shortcut-key-btn shortcut-alt" data-shortcut="zoomIn" data-index="1" title="Click to add alternate key"></button>
                            </div>
                        </div>
                        <div class="setting-item shortcut-item">
                            <div class="setting-info">
                                <label>Zoom Out</label>
                                <p class="setting-description">Decrease PDF zoom</p>
                            </div>
                            <div class="shortcut-keys">
                                <button class="shortcut-key-btn" data-shortcut="zoomOut" data-index="0" title="Click to change">‚àí</button>
                                <button class="shortcut-key-btn shortcut-alt" data-shortcut="zoomOut" data-index="1" title="Click to add alternate key"></button>
                            </div>
                        </div>
                        <div class="setting-item shortcut-item">
                            <div class="setting-info">
                                <label>Exit Viewer</label>
                                <p class="setting-description">Close and return to library</p>
                            </div>
                            <div class="shortcut-keys">
                                <button class="shortcut-key-btn" data-shortcut="exitViewer" data-index="0" title="Click to change">Esc</button>
                                <button class="shortcut-key-btn shortcut-alt" data-shortcut="exitViewer" data-index="1" title="Click to add alternate key"></button>
                            </div>
                        </div>
                        <button id="reset-shortcuts-btn" class="btn btn-secondary" style="margin-top: 12px;">Reset to Defaults</button>
                    </section>

                    <!-- Backup Section -->
                    <section class="settings-section" data-section="backup">
                        <h3>Backup & Restore</h3>
                        <p class="section-description">Create and manage backups of your patterns, settings, and data</p>

                        <div class="warning-banner">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path>
                                <line x1="12" y1="9" x2="12" y2="13"></line>
                                <line x1="12" y1="17" x2="12.01" y2="17"></line>
                            </svg>
                            <span>This feature is experimental. Always keep additional copies of important patterns.</span>
                        </div>

                        <div class="backup-create-section">
                            <button id="create-backup-btn" class="btn btn-primary">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 8px;">
                                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                    <polyline points="17 8 12 3 7 8"></polyline>
                                    <line x1="12" y1="3" x2="12" y2="15"></line>
                                </svg>
                                Create Backup
                            </button>
                        </div>

                        <h4 class="settings-subheading">Backup Options</h4>
                        <div class="setting-item">
                            <div class="setting-info">
                                <label>Include Pattern Library</label>
                                <p class="setting-description" id="library-size-info">Loading library size...</p>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="backup-include-patterns" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <div class="setting-item">
                            <div class="setting-info">
                                <label>Include Images</label>
                                <p class="setting-description" id="images-size-info">Loading images size...</p>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="backup-include-images" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <div class="setting-item">
                            <div class="setting-info">
                                <label>Include Archive</label>
                                <p class="setting-description" id="archive-size-info">Loading archive size...</p>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="backup-include-archive">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <p class="backup-estimate" id="backup-estimate">Estimated backup size: calculating...</p>

                        <h4 class="settings-subheading">Schedule</h4>
                        <div class="setting-item">
                            <div class="setting-info">
                                <label>Scheduled Backups</label>
                                <p class="setting-description">Automatically create backups</p>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="backup-schedule-enabled">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <div id="backup-schedule-options" style="display: none;">
                            <div class="setting-item">
                                <div class="setting-info">
                                    <label>Frequency</label>
                                    <p class="setting-description">How often to backup</p>
                                </div>
                                <select id="backup-schedule-select" class="settings-select">
                                    <option value="daily">Daily</option>
                                    <option value="weekly">Weekly</option>
                                    <option value="monthly">Monthly</option>
                                </select>
                            </div>
                            <div class="setting-item">
                                <div class="setting-info">
                                    <label>Time</label>
                                    <p class="setting-description">When to run backups (24h, local time)</p>
                                </div>
                                <input type="time" id="backup-time-input" class="settings-input" value="03:00">
                            </div>
                        </div>

                        <h4 class="settings-subheading">Cleanup</h4>
                        <div class="setting-item">
                            <div class="setting-info">
                                <label>Auto Cleanup</label>
                                <p class="setting-description">Automatically delete old backups</p>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="backup-prune-enabled">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <div id="backup-prune-options" style="display: none;">
                            <div class="setting-item">
                                <div class="setting-info">
                                    <label>Delete by</label>
                                    <p class="setting-description">How to determine which backups to delete</p>
                                </div>
                                <select id="backup-prune-mode" class="settings-select">
                                    <option value="keep">Number of backups</option>
                                    <option value="days">Age of backup</option>
                                </select>
                            </div>
                            <div class="setting-item" id="prune-keep-container">
                                <div class="setting-info">
                                    <label>Keep last</label>
                                    <p class="setting-description">Delete backups beyond this count</p>
                                </div>
                                <div class="input-with-suffix">
                                    <input type="number" id="backup-prune-value" class="settings-input" value="5" min="1" max="999">
                                    <span class="input-suffix">backups</span>
                                </div>
                            </div>
                            <div class="setting-item" id="prune-age-container" style="display: none;">
                                <div class="setting-info">
                                    <label>Older than</label>
                                    <p class="setting-description">Delete backups older than this</p>
                                </div>
                                <div class="input-with-select">
                                    <input type="number" id="backup-prune-age-value" class="settings-input" value="30" min="1" max="999">
                                    <select id="backup-prune-age-unit" class="settings-select">
                                        <option value="days">days</option>
                                        <option value="weeks">weeks</option>
                                        <option value="months">months</option>
                                        <option value="years">years</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <h4 class="settings-subheading">Saved Backups</h4>
                        <div class="backups-list" id="backups-list">
                            <p class="no-backups">Loading backups...</p>
                        </div>
                        <p class="backup-location">Backups are saved to <code id="backup-path-display">./backups</code></p>
                    </section>

                    <!-- Storage Section -->
                    <section class="settings-section" data-section="storage">
                        <h3>Storage</h3>
                        <p class="section-description">Manage uploaded images and storage</p>

                        <h4 class="settings-subheading">Library</h4>
                        <div class="storage-stats" id="storage-stats">
                            <!-- Storage stats will be populated here -->
                        </div>

                        <h4 class="settings-subheading">Images</h4>
                        <div class="setting-item">
                            <div class="setting-info">
                                <label><span id="storage-images-count">Loading...</span> <span class="setting-hint" id="storage-images-size"></span></label>
                            </div>
                        </div>

                        <h4 class="settings-subheading">Orphaned Images</h4>
                        <div class="setting-item">
                            <div class="setting-info">
                                <label><span id="orphaned-images-count">Checking...</span> <span class="setting-hint" id="orphaned-images-desc"></span></label>
                            </div>
                            <button id="cleanup-images-btn" class="btn btn-secondary" style="display: none;">
                                Clean Up
                            </button>
                        </div>
                        <ul class="orphaned-images-list" id="orphaned-images-list"></ul>
                    </section>

                    <!-- Archive Section -->
                    <section class="settings-section" data-section="archive">
                        <h3>Archive</h3>
                        <p class="section-description">Manage archived patterns</p>

                        <h4 class="settings-subheading">Behavior</h4>
                        <div class="setting-item">
                            <div class="setting-info">
                                <label>Delete instead of archive</label>
                                <p class="setting-description">Disables archive and replaces archive button with delete button that permanently deletes files</p>
                                <p class="setting-description" id="delete-mode-warning" style="display: none; font-style: italic;">Enabling will permanently delete all archived patterns</p>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="enable-delete-checkbox">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>

                        <div id="archive-settings-section">
                            <div class="setting-item">
                                <div class="setting-info">
                                    <label>Auto Empty</label>
                                    <p class="setting-description">Automatically delete archived patterns after a set time</p>
                                </div>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="auto-delete-checkbox">
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>

                            <div class="setting-item" id="auto-delete-days-setting" style="display: none;">
                                <div class="setting-info">
                                    <label>Empty After</label>
                                    <p class="setting-description">Days before archived patterns are permanently deleted</p>
                                </div>
                                <div class="setting-input-group">
                                    <input type="number" id="auto-delete-days" class="settings-input" min="1" max="365" value="30" style="width: 70px;">
                                    <span class="setting-hint">days</span>
                                </div>
                            </div>
                        </div>

                        <div id="archived-patterns-section">
                            <h4 class="settings-subheading">Archived Patterns</h4>
                            <div class="setting-item">
                                <div class="setting-info">
                                    <label><span id="archived-patterns-count">0 archived patterns</span></label>
                                </div>
                                <button id="delete-all-archived-btn" class="btn btn-danger" style="display: none;">
                                    Delete All
                                </button>
                            </div>

                            <div class="archived-patterns-list" id="archived-patterns-list">
                                <p class="no-archived">Loading...</p>
                            </div>
                        </div>
                    </section>

                    <!-- Notifications Section -->
                    <section class="settings-section" data-section="notifications">
                        <h3>Notifications</h3>
                        <p class="section-description">Configure push notifications for app events</p>

                        <h4 class="settings-subheading">Pushover</h4>
                        <div class="setting-item">
                            <div class="setting-info">
                                <label>Enable Pushover</label>
                                <p class="setting-description">Send notifications to your device</p>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="pushover-enabled">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <div id="pushover-settings" style="display: none;">
                            <div class="setting-item">
                                <div class="setting-info">
                                    <label>User Key</label>
                                    <p class="setting-description">Your Pushover user key</p>
                                </div>
                                <input type="password" id="pushover-user-key" class="settings-input" placeholder="Enter user key">
                            </div>
                            <div class="setting-item">
                                <div class="setting-info">
                                    <label>API Token</label>
                                    <p class="setting-description">Your Pushover API token</p>
                                </div>
                                <input type="password" id="pushover-app-token" class="settings-input" placeholder="Enter app token">
                            </div>
                            <div class="setting-item">
                                <div class="setting-info">
                                    <label>Test Connection</label>
                                    <p class="setting-description">Send a test notification</p>
                                </div>
                                <button id="pushover-test-btn" class="btn btn-secondary">Send Test</button>
                            </div>
                        </div>

                        <h4 class="settings-subheading">Events</h4>
                        <div class="setting-item">
                            <div class="setting-info">
                                <label>Backup Complete</label>
                                <p class="setting-description">Notify when backups finish</p>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="notify-backup-complete" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <div class="setting-item">
                            <div class="setting-info">
                                <label>Backup Errors</label>
                                <p class="setting-description">Notify when backups fail</p>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="notify-backup-error" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <div class="setting-item">
                            <div class="setting-info">
                                <label>Archive Emptied</label>
                                <p class="setting-description">Notify when archived patterns are auto-deleted</p>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="notify-auto-delete" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </section>

                    <!-- About Section -->
                    <section class="settings-section" data-section="about">
                        <h3>About Yarnl</h3>
                        <p class="section-description">Crochet pattern management app</p>

                        <h4 class="settings-subheading">Library Stats</h4>
                        <div class="library-stats" id="library-stats">
                            <!-- Stats will be populated here -->
                        </div>

                        <h4 class="settings-subheading">App Info</h4>
                        <div class="about-info">
                            <p><strong>Version:</strong> 1.0.0</p>
                            <p><strong>Made with:</strong> Node.js, Express, PostgreSQL</p>
                        </div>

                        <h4 class="settings-subheading">Links</h4>
                        <div class="about-links">
                            <a href="https://github.com/titandrive/yarnl" target="_blank" rel="noopener noreferrer" class="about-link">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
                                </svg>
                                GitHub
                            </a>
                            <a href="https://yarnl.com" target="_blank" rel="noopener noreferrer" class="about-link">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <circle cx="12" cy="12" r="10"></circle>
                                    <line x1="2" y1="12" x2="22" y2="12"></line>
                                    <path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path>
                                </svg>
                                Website
                            </a>
                        </div>
                    </section>
                </div>
            </div>
        </div>

        <!-- PDF Viewer with Counter Overlay (hidden by default, shown when clicking a pattern) -->
        <div id="pdf-viewer-container" class="pdf-viewer-container" style="display: none;">
            <div class="pdf-header">
                <div class="pdf-header-left">
                    <button id="pdf-back-btn" class="btn btn-secondary">‚Üê Back</button>
                    <button id="pdf-notes-btn" class="btn btn-secondary">Notes</button>
                    <button id="pdf-edit-btn" class="btn btn-secondary">Edit</button>
                    <button id="pdf-info-btn" class="btn btn-secondary">Info</button>
                </div>
                <h2 id="pdf-pattern-name"></h2>
                <div class="pdf-header-right">
                    <div class="timer-control">
                        <label class="auto-timer-toggle" title="Auto timer: runs while viewing, pauses on inactivity">
                            <input type="checkbox" id="pdf-auto-timer-checkbox">
                            <span class="auto-timer-slider"></span>
                            <span class="auto-timer-label">Auto</span>
                        </label>
                        <button id="pdf-timer-btn" class="btn btn-secondary timer-btn">
                            <svg class="timer-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <circle cx="12" cy="12" r="10"></circle>
                                <polyline points="12 6 12 12 16 14"></polyline>
                            </svg>
                            <span id="pdf-timer-display">0:00:00</span>
                        </button>
                        <button id="pdf-timer-reset-btn" class="timer-reset-btn" title="Reset timer">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                                <line x1="18" y1="6" x2="6" y2="18"></line>
                                <line x1="6" y1="6" x2="18" y2="18"></line>
                            </svg>
                        </button>
                    </div>
                    <div class="pdf-nav-controls">
                        <button id="prev-page-btn" class="btn btn-secondary">‚Üê</button>
                        <span id="page-info">Page 1 of 1</span>
                        <button id="next-page-btn" class="btn btn-secondary">‚Üí</button>
                    </div>
                </div>
            </div>

            <div class="pdf-viewer-wrapper">
                <canvas id="pdf-canvas"></canvas>

                <!-- Floating Zoom Controls -->
                <div class="pdf-zoom-overlay">
                    <button id="zoom-fit-btn" class="zoom-btn zoom-fit" title="Fit page to view">Fit</button>
                    <button id="zoom-out-btn" class="zoom-btn" title="Zoom out">‚àí</button>
                    <input type="text" id="zoom-level" value="Fit" title="Enter zoom percentage">
                    <button id="zoom-in-btn" class="zoom-btn" title="Zoom in">+</button>
                    <button id="zoom-100-btn" class="zoom-btn zoom-fit" title="Fit width to screen">Zoom</button>
                </div>
            </div>

            <!-- Shared Counter Overlay at Bottom -->
            <div id="shared-counter-overlay" class="counter-overlay">
                <div id="counters-list" class="counters-list">
                    <!-- Counters will be dynamically added here -->
                </div>
                <div class="counter-actions">
                    <button id="add-counter-btn" class="btn btn-success">+</button>
                </div>
            </div>

            <!-- Notes Popover -->
            <div id="notes-popover" class="notes-popover" style="display: none;">
                <div class="notes-popover-header">
                    <div class="notes-tabs">
                        <button class="notes-tab active" data-tab="edit">Edit</button>
                        <button class="notes-tab" data-tab="preview">Preview</button>
                    </div>
                    <button id="notes-close-btn" class="notes-close">&times;</button>
                </div>
                <div class="notes-popover-body">
                    <textarea id="notes-editor" placeholder="Write your notes here... Markdown supported!"></textarea>
                    <div id="notes-preview" class="notes-preview" style="display: none;"></div>
                </div>
                <div class="notes-popover-footer">
                    <label class="notes-live-preview-label">
                        <input type="checkbox" id="notes-live-preview">
                        <span>Live preview</span>
                    </label>
                    <span id="notes-save-status" class="notes-save-status"></span>
                    <button id="notes-clear-btn" class="btn btn-secondary btn-small">Clear</button>
                </div>
            </div>

            <!-- Edit PDF Pattern Modal -->
            <div id="pdf-edit-modal" class="modal" style="display: none;">
                <div class="modal-content pdf-edit-modal-content">
                    <div class="modal-header">
                        <h2>Edit Pattern</h2>
                        <button class="modal-close" id="close-pdf-edit-modal">&times;</button>
                    </div>
                    <div class="pdf-edit-form">
                        <div class="form-group">
                            <label for="pdf-edit-name">Pattern Name *</label>
                            <input type="text" id="pdf-edit-name" required>
                        </div>
                        <div class="form-group">
                            <label>Category</label>
                            <div id="pdf-edit-category-container">
                                <!-- Category dropdown will be populated dynamically -->
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="pdf-edit-description">Description</label>
                            <textarea id="pdf-edit-description" rows="3" placeholder="Brief description..."></textarea>
                        </div>
                        <div class="form-group">
                            <label>Hashtags</label>
                            <div id="pdf-edit-hashtags-container">
                                <!-- Hashtag selector will be populated dynamically -->
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Thumbnail</label>
                            <div class="thumbnail-selector" id="pdf-edit-thumbnail-selector" data-target="pdf-edit">
                                <div class="thumbnail-selector-preview" id="pdf-edit-thumbnail-preview">
                                    <span class="thumbnail-selector-placeholder">+</span>
                                </div>
                            </div>
                            <small class="form-hint">Click to select or paste an image</small>
                        </div>
                        <div class="form-group mark-current-toggle">
                            <span class="mark-current-label">Mark as current pattern</span>
                            <label class="toggle-switch">
                                <input type="checkbox" id="pdf-edit-is-current">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>
                    <div class="modal-actions">
                        <button type="button" class="btn btn-danger" id="delete-pdf-pattern">Delete Pattern</button>
                        <div class="modal-actions-right">
                            <button type="button" class="btn btn-secondary" id="cancel-pdf-edit">Cancel</button>
                            <button type="button" class="btn btn-primary" id="save-pdf-edit">Save Changes</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Pattern Info Modal -->
            <div id="pattern-info-modal" class="modal" style="display: none;">
                <div class="modal-content pattern-info-modal-content">
                    <div class="modal-header">
                        <h2>Pattern Info</h2>
                        <button class="modal-close" id="close-pattern-info-modal">&times;</button>
                    </div>
                    <div class="pattern-info-content">
                        <div class="info-grid" id="pattern-info-grid">
                            <!-- Info will be populated dynamically -->
                        </div>
                    </div>
                    <div class="modal-actions">
                        <button type="button" class="btn btn-secondary" id="close-pattern-info-btn">Close</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Markdown Pattern Viewer -->
    <div id="markdown-viewer-container" class="markdown-viewer-container" style="display: none;">
        <div class="markdown-header">
            <div class="markdown-header-left">
                <button id="markdown-back-btn" class="btn btn-secondary">‚Üê Back</button>
                <button id="markdown-notes-btn" class="btn btn-secondary">Notes</button>
                <button id="markdown-edit-btn" class="btn btn-secondary">Edit</button>
                <button id="markdown-info-btn" class="btn btn-secondary">Info</button>
            </div>
            <h2 id="markdown-pattern-name"></h2>
            <div class="markdown-header-right">
                <div class="timer-control">
                    <label class="auto-timer-toggle" title="Auto timer: runs while viewing, pauses on inactivity">
                        <input type="checkbox" id="markdown-auto-timer-checkbox">
                        <span class="auto-timer-slider"></span>
                        <span class="auto-timer-label">Auto</span>
                    </label>
                    <button id="markdown-timer-btn" class="btn btn-secondary timer-btn">
                        <svg class="timer-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="12" cy="12" r="10"></circle>
                            <polyline points="12 6 12 12 16 14"></polyline>
                        </svg>
                        <span id="markdown-timer-display">0:00:00</span>
                    </button>
                    <button id="markdown-timer-reset-btn" class="timer-reset-btn" title="Reset timer">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                            <line x1="18" y1="6" x2="6" y2="18"></line>
                            <line x1="6" y1="6" x2="18" y2="18"></line>
                        </svg>
                    </button>
                </div>
            </div>
        </div>

        <div class="markdown-viewer-wrapper">
            <div id="markdown-content" class="markdown-content">
                <!-- Rendered markdown content will go here -->
            </div>
        </div>

        <!-- Counter overlay is shared - see #shared-counter-overlay -->

        <!-- Notes Popover (reuse same structure) -->
        <div id="markdown-notes-popover" class="notes-popover" style="display: none;">
            <div class="notes-popover-header">
                <div class="notes-tabs">
                    <button class="notes-tab active" data-tab="edit">Edit</button>
                    <button class="notes-tab" data-tab="preview">Preview</button>
                </div>
                <button id="markdown-notes-close-btn" class="notes-close">&times;</button>
            </div>
            <div class="notes-popover-body">
                <textarea id="markdown-notes-editor" placeholder="Write your notes here... Markdown supported!"></textarea>
                <div id="markdown-notes-preview" class="notes-preview" style="display: none;"></div>
            </div>
            <div class="notes-popover-footer">
                <label class="notes-live-preview-label">
                    <input type="checkbox" id="markdown-notes-live-preview">
                    <span>Live preview</span>
                </label>
                <span id="markdown-notes-save-status" class="notes-save-status"></span>
                <button id="markdown-notes-clear-btn" class="btn btn-secondary btn-small">Clear</button>
            </div>
        </div>

        <!-- Edit Pattern Content Modal -->
        <div id="markdown-edit-modal" class="modal" style="display: none;">
            <div class="modal-content modal-large">
                <div class="modal-header">
                    <h2>Edit Pattern</h2>
                    <div class="markdown-edit-tabs">
                        <button type="button" class="markdown-edit-tab active" data-tab="edit">Edit</button>
                        <button type="button" class="markdown-edit-tab" data-tab="preview">Preview</button>
                        <label class="markdown-edit-live-preview-label">
                            <input type="checkbox" id="markdown-edit-live-preview">
                            <span>Live preview</span>
                        </label>
                    </div>
                    <button class="modal-close" id="close-markdown-edit-modal">&times;</button>
                </div>
                <div class="markdown-edit-wrapper">
                    <div class="markdown-edit-sidebar">
                        <div class="form-group">
                            <label for="markdown-edit-name">Pattern Name *</label>
                            <input type="text" id="markdown-edit-name" required>
                        </div>
                        <div class="form-group">
                            <label>Category</label>
                            <div id="markdown-edit-category-container">
                                <!-- Category dropdown will be populated dynamically -->
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="markdown-edit-description">Description</label>
                            <textarea id="markdown-edit-description" rows="2" placeholder="Brief description..."></textarea>
                        </div>
                        <div class="form-group">
                            <label>Hashtags</label>
                            <div id="markdown-edit-hashtags-container">
                                <!-- Hashtag selector will be populated dynamically -->
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Thumbnail</label>
                            <div class="thumbnail-selector" id="markdown-edit-thumbnail-selector" data-target="markdown-edit">
                                <div class="thumbnail-selector-preview" id="markdown-edit-thumbnail-preview">
                                    <span class="thumbnail-selector-placeholder">+</span>
                                </div>
                            </div>
                            <small class="form-hint">Click to select or paste an image</small>
                        </div>
                        <div class="form-group mark-current-toggle">
                            <span class="mark-current-label">Mark as current pattern</span>
                            <label class="toggle-switch">
                                <input type="checkbox" id="markdown-edit-is-current">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>
                    <div class="markdown-edit-main">
                        <div class="markdown-edit-body edit-mode">
                            <textarea id="markdown-edit-content" placeholder="Edit pattern content..."></textarea>
                            <div id="markdown-edit-preview" class="markdown-edit-preview"></div>
                        </div>
                    </div>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-danger" id="delete-markdown-pattern">Delete Pattern</button>
                    <div class="modal-actions-right">
                        <button type="button" class="btn btn-secondary" id="cancel-markdown-edit">Cancel</button>
                        <button type="button" class="btn btn-primary" id="save-markdown-edit">Save Changes</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Pattern Modal -->
    <div id="edit-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Edit Pattern</h2>
                <button class="modal-close" id="close-edit-modal">&times;</button>
            </div>
            <form id="edit-form">
                <div class="form-group">
                    <label for="edit-pattern-name">Pattern Name *</label>
                    <input type="text" id="edit-pattern-name" required>
                </div>
                <div class="form-group">
                    <label>Category</label>
                    <div id="edit-pattern-category-container">
                        <!-- Category dropdown will be populated dynamically -->
                    </div>
                </div>
                <div class="form-group">
                    <label for="edit-pattern-description">Description <span class="char-counter"><span id="edit-desc-count">0</span>/45</span></label>
                    <textarea id="edit-pattern-description" rows="2" maxlength="45" oninput="document.getElementById('edit-desc-count').textContent = this.value.length"></textarea>
                </div>
                <div class="form-group">
                    <label>Hashtags</label>
                    <div id="edit-pattern-hashtags-container">
                        <!-- Hashtag selector will be populated dynamically -->
                    </div>
                </div>
                <div class="form-group">
                    <label>Custom Thumbnail (optional)</label>
                    <div class="thumbnail-selector" id="edit-thumbnail-selector" data-target="edit">
                        <div class="thumbnail-selector-preview" id="edit-thumbnail-preview">
                            <span class="thumbnail-selector-placeholder">+</span>
                        </div>
                    </div>
                    <p class="help-text">Click to select or paste an image</p>
                </div>
                <div class="form-group mark-current-toggle">
                    <span class="mark-current-label">Mark as current pattern</span>
                    <label class="toggle-switch">
                        <input type="checkbox" id="edit-is-current">
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-danger" id="delete-edit-pattern">Delete Pattern</button>
                    <div class="modal-actions-right">
                        <button type="button" class="btn btn-secondary" id="cancel-edit-btn">Cancel</button>
                        <button type="submit" class="btn btn-primary">Save Changes</button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <!-- Thumbnail Selector Modal -->
    <div id="thumbnail-modal" class="modal" style="display: none;">
        <div class="modal-content thumbnail-modal-content">
            <div class="modal-header">
                <h2>Select Thumbnail</h2>
                <button class="modal-close" id="close-thumbnail-modal">&times;</button>
            </div>
            <div class="thumbnail-modal-body">
                <div class="thumbnail-preview-area" id="thumbnail-preview-area">
                    <div class="thumbnail-placeholder" id="thumbnail-placeholder">
                        <span class="thumbnail-placeholder-icon">üñºÔ∏è</span>
                        <p>No image selected</p>
                    </div>
                    <img id="thumbnail-preview-img" class="thumbnail-preview-img" style="display: none;" alt="Thumbnail preview">
                </div>
                <div class="thumbnail-actions">
                    <button type="button" class="btn btn-secondary thumbnail-action-btn" id="thumbnail-browse-btn">
                        <span class="btn-icon">üìÅ</span>
                        <span>Browse Files</span>
                    </button>
                    <button type="button" class="btn btn-secondary thumbnail-action-btn" id="thumbnail-paste-btn">
                        <span class="btn-icon">üìã</span>
                        <span>Paste from Clipboard</span>
                    </button>
                    <input type="file" id="thumbnail-file-input" accept="image/*" hidden>
                </div>
                <p class="thumbnail-hint">You can also paste an image directly (Ctrl+V / Cmd+V)</p>
            </div>
            <div class="modal-actions">
                <button type="button" class="btn btn-secondary" id="thumbnail-clear-btn">Clear</button>
                <button type="button" class="btn btn-secondary" id="cancel-thumbnail-btn">Cancel</button>
                <button type="button" class="btn btn-primary" id="confirm-thumbnail-btn">Use This Image</button>
            </div>
        </div>
    </div>

    <div id="mascot-modal" class="modal" style="display: none;">
        <div class="modal-content mascot-modal-content">
            <div class="modal-header">
                <h3>Choose Mascot</h3>
                <button class="modal-close" id="close-mascot-modal">&times;</button>
            </div>
            <div id="mascot-grid" class="mascot-grid">
                <p>Loading mascots...</p>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/12.0.0/marked.min.js"></script>
    <script src="app.js?v=72"></script>
</body>
</html>
