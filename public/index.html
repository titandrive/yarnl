<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Yarnl - Crochet Project Manager</title>
    <script>
        // Set theme immediately to prevent flash
        const theme = localStorage.getItem('theme') || 'dark';
        document.documentElement.setAttribute('data-theme', theme);
    </script>
    <link rel="icon" type="image/svg+xml" href="favicon.svg?v=2">
    <link rel="stylesheet" href="styles.css?v=19">
</head>
<body>
    <div class="container">
        <header>
            <div class="header-btn-container header-left">
                <button id="settings-btn" class="header-btn header-btn-labeled" aria-label="Settings">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="12" cy="12" r="3"></circle>
                        <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
                    </svg>
                    <span>Settings</span>
                </button>
            </div>
            <div class="header-title">
                <h1>üß∂ Yarnl</h1>
                <p class="subtitle">Your Crochet Project Companion</p>
            </div>
            <div class="header-btn-container header-right">
                <button id="add-pattern-btn" class="header-btn header-btn-labeled" aria-label="Add pattern">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="12" y1="5" x2="12" y2="19"></line>
                        <line x1="5" y1="12" x2="19" y2="12"></line>
                    </svg>
                    <span>New Pattern</span>
                </button>
                <div id="add-menu" class="add-menu" style="display: none;">
                    <button class="add-menu-item" id="add-upload-pdf">PDF</button>
                    <button class="add-menu-item" id="add-new-pattern">Markdown</button>
                </div>
            </div>
        </header>

        <nav class="tabs">
            <button class="tab-btn active" data-tab="current">Current<span class="tab-count" id="current-tab-count"></span></button>
            <button class="tab-btn" data-tab="library">Library<span class="tab-count" id="library-tab-count"></span></button>
        </nav>

        <!-- Current Patterns Tab -->
        <div id="current" class="tab-content active">
            <div class="current-patterns-container">
                <div id="current-patterns-grid" class="patterns-grid">
                    <p class="empty-state">No current patterns. Mark a pattern as current to start tracking!</p>
                </div>
            </div>
        </div>

        <!-- Pattern Library Tab -->
        <div id="library" class="tab-content">
            <div class="patterns-container">
                <div class="library-layout">
                    <aside class="library-sidebar">
                        <div class="sidebar-section">
                            <label for="search-input">Search</label>
                            <input type="text" id="search-input" placeholder="Search patterns...">
                        </div>
                        <div class="sidebar-section">
                            <label for="category-filter-select">Category</label>
                            <select id="category-filter-select">
                                <option value="all">All Categories</option>
                            </select>
                        </div>
                        <div class="sidebar-section">
                            <label for="sort-select">Sort by</label>
                            <select id="sort-select">
                                <option value="date-desc">Date (Newest)</option>
                                <option value="date-asc">Date (Oldest)</option>
                                <option value="name-asc">Name (A-Z)</option>
                                <option value="name-desc">Name (Z-A)</option>
                            </select>
                        </div>
                        <div class="sidebar-section">
                            <label>Status</label>
                            <label class="checkbox-label">
                                <input type="checkbox" id="show-completed" checked>
                                Completed
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" id="show-current" checked>
                                Current
                            </label>
                        </div>
                        <div class="sidebar-section">
                            <label>Type</label>
                            <label class="checkbox-label">
                                <input type="checkbox" id="show-pdf" checked>
                                PDF
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" id="show-markdown" checked>
                                Markdown
                            </label>
                        </div>
                        <div class="sidebar-section">
                            <label>Highlight</label>
                            <label class="checkbox-label">
                                <input type="checkbox" id="highlight-new">
                                New Patterns
                            </label>
                        </div>
                    </aside>
                    <div id="patterns-grid" class="patterns-grid">
                        <p class="empty-state">No patterns yet. Upload your first pattern!</p>
                    </div>
                </div>
            </div>

            <!-- Upload Panel (hidden until needed) -->
            <div id="upload-panel" class="upload-panel" style="display: none;">
                <div class="upload-panel-header">
                    <h3>Upload Patterns</h3>
                    <button id="close-upload-panel" class="btn btn-secondary">‚Üê Back to Library</button>
                </div>
                <div class="upload-container">
                    <div id="drop-zone" class="drop-zone">
                        <div class="drop-zone-content">
                            <span class="drop-zone-icon">üìÑ</span>
                            <p class="drop-zone-text">Drag & drop PDF files here or click to browse</p>
                            <p class="drop-zone-subtext">You can select multiple files at once</p>
                            <input type="file" id="file-input" accept=".pdf" multiple hidden>
                            <button type="button" id="browse-btn" class="btn btn-secondary">Browse Files</button>
                        </div>
                    </div>

                    <!-- Staging Area -->
                    <div id="staging-area" class="staging-area" style="display: none;">
                        <div class="staging-header">
                            <h3>Staged Files (<span id="staged-count">0</span>)</h3>
                            <div class="staging-actions">
                                <button type="button" id="upload-all-btn" class="btn btn-primary">Upload All</button>
                                <button type="button" id="clear-all-btn" class="btn btn-secondary">Clear All</button>
                            </div>
                        </div>
                        <div id="staged-files-list" class="staged-files-list">
                            <!-- Staged files will be added here -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- New Pattern Panel (for markdown patterns) -->
            <div id="new-pattern-panel" class="new-pattern-panel" style="display: none;">
                <div class="new-pattern-header">
                    <h3>Create New Pattern</h3>
                    <button id="close-new-pattern-panel" class="btn btn-secondary">‚Üê Back to Library</button>
                </div>
                <div class="new-pattern-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="new-pattern-name">Pattern Name *</label>
                            <input type="text" id="new-pattern-name" required placeholder="Enter pattern name">
                        </div>
                        <div class="form-group">
                            <label>Category</label>
                            <div id="new-pattern-category-container">
                                <!-- Category dropdown will be populated dynamically -->
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="new-pattern-description">Description</label>
                        <input type="text" id="new-pattern-description" placeholder="Brief description (optional)">
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Hashtags</label>
                            <div id="new-pattern-hashtags-container">
                                <!-- Hashtag selector will be populated dynamically -->
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Thumbnail (optional)</label>
                            <div class="thumbnail-selector" id="new-pattern-thumbnail-selector" data-target="new-pattern">
                                <div class="thumbnail-selector-preview" id="new-pattern-thumbnail-preview">
                                    <span class="thumbnail-selector-placeholder">+</span>
                                </div>
                            </div>
                            <small class="form-hint">Click to select or paste an image</small>
                        </div>
                    </div>
                    <div class="form-group new-pattern-content-group">
                        <div class="new-pattern-content-header">
                            <label>Pattern Content (Markdown)</label>
                            <div class="new-pattern-tabs">
                                <button type="button" class="new-pattern-tab active" data-tab="edit">Edit</button>
                                <button type="button" class="new-pattern-tab" data-tab="preview">Preview</button>
                                <label class="new-pattern-live-preview-label">
                                    <input type="checkbox" id="new-pattern-live-preview">
                                    <span>Live preview</span>
                                </label>
                            </div>
                        </div>
                        <div class="new-pattern-editor-wrapper">
                            <textarea id="new-pattern-content" placeholder="Write your pattern here... Markdown supported!

Example:
# My Pattern

## Materials
- Yarn: Worsted weight
- Hook: 5mm

## Instructions
### Round 1
6 sc in magic ring (6)

### Round 2
Inc in each st around (12)
"></textarea>
                            <div id="new-pattern-preview" class="new-pattern-preview"></div>
                        </div>
                    </div>
                    <div class="form-group checkbox-group">
                        <label>
                            <input type="checkbox" id="new-pattern-is-current">
                            Mark as current pattern
                        </label>
                    </div>
                    <div class="new-pattern-actions">
                        <button type="button" id="cancel-new-pattern" class="btn btn-secondary">Cancel</button>
                        <button type="button" id="save-new-pattern" class="btn btn-primary">Create Pattern</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Settings Tab -->
        <div id="settings" class="tab-content">
            <div class="settings-layout">
                <!-- Settings Sidebar -->
                <nav class="settings-sidebar">
                    <button class="settings-nav-btn active" data-section="appearance">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="12" cy="12" r="3"></circle>
                            <path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"></path>
                        </svg>
                        <span>Appearance</span>
                    </button>
                    <button class="settings-nav-btn" data-section="categories">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M4 4h6v6H4zM14 4h6v6h-6zM4 14h6v6H4zM14 14h6v6h-6z"></path>
                        </svg>
                        <span>Categories & Tags</span>
                    </button>
                    <button class="settings-nav-btn" data-section="shortcuts">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <rect x="2" y="4" width="20" height="16" rx="2"></rect>
                            <path d="M6 8h.01M10 8h.01M14 8h.01M18 8h.01M6 12h.01M10 12h.01M14 12h.01M18 12h.01M8 16h8"></path>
                        </svg>
                        <span>Keyboard Shortcuts</span>
                    </button>
                    <button class="settings-nav-btn" data-section="about">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="12" cy="12" r="10"></circle>
                            <line x1="12" y1="16" x2="12" y2="12"></line>
                            <line x1="12" y1="8" x2="12.01" y2="8"></line>
                        </svg>
                        <span>About</span>
                    </button>
                </nav>

                <!-- Settings Content -->
                <div class="settings-content">
                    <!-- Appearance Section -->
                    <section class="settings-section active" data-section="appearance">
                        <h3>Appearance</h3>
                        <div class="setting-item">
                            <div class="setting-info">
                                <label>Theme</label>
                                <p class="setting-description">Choose a color theme</p>
                            </div>
                            <select id="theme-select" class="settings-select">
                                <optgroup label="Light Themes">
                                    <option value="lavender-light">Lavender</option>
                                    <option value="ocean-light">Ocean</option>
                                    <option value="forest-light">Forest</option>
                                    <option value="sunset-light">Sunset</option>
                                    <option value="rose-light">Rose</option>
                                    <option value="slate-light">Slate</option>
                                    <option value="aqua-light">Aqua</option>
                                </optgroup>
                                <optgroup label="Dark Themes">
                                    <option value="lavender-dark">Lavender</option>
                                    <option value="ocean-dark">Ocean</option>
                                    <option value="forest-dark">Forest</option>
                                    <option value="sunset-dark">Sunset</option>
                                    <option value="rose-dark">Rose</option>
                                    <option value="slate-dark">Slate</option>
                                    <option value="aqua-dark">Aqua</option>
                                    <option value="midnight-dark">Midnight</option>
                                    <option value="razer-dark">Razer</option>
                                    <option value="synthwave-dark">Synthwave</option>
                                    <option value="cyberpunk-dark">Cyberpunk</option>
                                    <option value="dracula-dark">Dracula</option>
                                    <option value="coffee-dark">Coffee</option>
                                    <option value="nasa-dark">NASA</option>
                                </optgroup>
                            </select>
                        </div>
                        <div class="setting-item">
                            <div class="setting-info">
                                <label>Gradient Header</label>
                                <p class="setting-description">Use gradient colors in header</p>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="gradient-checkbox">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <div class="setting-item">
                            <div class="setting-info">
                                <label>Tab Counts</label>
                                <p class="setting-description">Show pattern counts on tabs</p>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="tab-counts-checkbox" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <div class="setting-item">
                            <div class="setting-info">
                                <label>Default Page</label>
                                <p class="setting-description">Page to show on startup</p>
                            </div>
                            <select id="default-page-select" class="settings-select">
                                <option value="current">Current</option>
                                <option value="library">Library</option>
                            </select>
                        </div>
                        <div class="setting-item">
                            <div class="setting-info">
                                <label>Default PDF Zoom</label>
                                <p class="setting-description">Initial zoom level for PDFs</p>
                            </div>
                            <select id="default-zoom-select" class="settings-select">
                                <option value="fit">Fit Page</option>
                                <option value="fit-width">Fit Width</option>
                                <option value="25">25%</option>
                                <option value="50">50%</option>
                                <option value="75">75%</option>
                                <option value="100">100%</option>
                                <option value="125">125%</option>
                                <option value="150">150%</option>
                                <option value="175">175%</option>
                                <option value="200">200%</option>
                            </select>
                        </div>

                        <h4 class="settings-subheading">Badges</h4>
                        <div class="setting-item">
                            <div class="setting-info">
                                <label>Type Badge</label>
                                <p class="setting-description">Show PDF/MD badge on cards</p>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="badge-type-checkbox" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <div class="setting-item">
                            <div class="setting-info">
                                <label>Status Badge</label>
                                <p class="setting-description">Show CURRENT/COMPLETE badge</p>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="badge-status-checkbox" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <div class="setting-item">
                            <div class="setting-info">
                                <label>Category Badge</label>
                                <p class="setting-description">Show category badge on cards</p>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="badge-category-checkbox" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </section>

                    <!-- Categories & Tags Section -->
                    <section class="settings-section" data-section="categories">
                        <h3>Categories</h3>
                        <p class="section-description">Manage pattern categories for organizing your library</p>
                        <div class="categories-list" id="categories-list">
                            <!-- Categories will be populated here -->
                        </div>
                        <div class="add-category-form">
                            <input type="text" id="new-category-input" placeholder="New category name...">
                            <button id="add-category-btn" class="btn btn-primary">Add</button>
                        </div>

                        <h4 class="settings-subheading">Hashtags</h4>
                        <p class="section-description">Manage hashtags for tagging patterns</p>
                        <div class="hashtags-list" id="hashtags-list">
                            <!-- Hashtags will be populated here -->
                        </div>
                        <div class="add-hashtag-form">
                            <input type="text" id="new-hashtag-input" placeholder="New hashtag...">
                            <button id="add-hashtag-btn" class="btn btn-primary">Add</button>
                        </div>
                    </section>

                    <!-- Keyboard Shortcuts Section -->
                    <section class="settings-section" data-section="shortcuts">
                        <h3>Keyboard Shortcuts</h3>
                        <p class="section-description">Customize keyboard shortcuts for the PDF viewer. Click a key to change it.</p>
                        <div class="setting-item shortcut-item">
                            <div class="setting-info">
                                <label>Increase Counter</label>
                            </div>
                            <div class="shortcut-keys">
                                <button class="shortcut-key-btn" data-shortcut="counterIncrease" data-index="0" title="Click to change">‚Üë</button>
                                <button class="shortcut-key-btn shortcut-alt" data-shortcut="counterIncrease" data-index="1" title="Click to add alternate key"></button>
                            </div>
                        </div>
                        <div class="setting-item shortcut-item">
                            <div class="setting-info">
                                <label>Decrease Counter</label>
                            </div>
                            <div class="shortcut-keys">
                                <button class="shortcut-key-btn" data-shortcut="counterDecrease" data-index="0" title="Click to change">‚Üì</button>
                                <button class="shortcut-key-btn shortcut-alt" data-shortcut="counterDecrease" data-index="1" title="Click to add alternate key"></button>
                            </div>
                        </div>
                        <div class="setting-item shortcut-item">
                            <div class="setting-info">
                                <label>Previous Page</label>
                            </div>
                            <div class="shortcut-keys">
                                <button class="shortcut-key-btn" data-shortcut="prevPage" data-index="0" title="Click to change">‚Üê</button>
                                <button class="shortcut-key-btn shortcut-alt" data-shortcut="prevPage" data-index="1" title="Click to add alternate key"></button>
                            </div>
                        </div>
                        <div class="setting-item shortcut-item">
                            <div class="setting-info">
                                <label>Next Page</label>
                            </div>
                            <div class="shortcut-keys">
                                <button class="shortcut-key-btn" data-shortcut="nextPage" data-index="0" title="Click to change">‚Üí</button>
                                <button class="shortcut-key-btn shortcut-alt" data-shortcut="nextPage" data-index="1" title="Click to add alternate key"></button>
                            </div>
                        </div>
                        <div class="setting-item shortcut-item">
                            <div class="setting-info">
                                <label>Start/Stop Timer</label>
                            </div>
                            <div class="shortcut-keys">
                                <button class="shortcut-key-btn" data-shortcut="toggleTimer" data-index="0" title="Click to change">Space</button>
                                <button class="shortcut-key-btn shortcut-alt" data-shortcut="toggleTimer" data-index="1" title="Click to add alternate key"></button>
                            </div>
                        </div>
                        <div class="setting-item shortcut-item">
                            <div class="setting-info">
                                <label>Next Counter</label>
                            </div>
                            <div class="shortcut-keys">
                                <button class="shortcut-key-btn" data-shortcut="nextCounter" data-index="0" title="Click to change">Tab</button>
                                <button class="shortcut-key-btn shortcut-alt" data-shortcut="nextCounter" data-index="1" title="Click to add alternate key"></button>
                            </div>
                        </div>
                        <div class="setting-item shortcut-item">
                            <div class="setting-info">
                                <label>Zoom In</label>
                            </div>
                            <div class="shortcut-keys">
                                <button class="shortcut-key-btn" data-shortcut="zoomIn" data-index="0" title="Click to change">+</button>
                                <button class="shortcut-key-btn shortcut-alt" data-shortcut="zoomIn" data-index="1" title="Click to add alternate key"></button>
                            </div>
                        </div>
                        <div class="setting-item shortcut-item">
                            <div class="setting-info">
                                <label>Zoom Out</label>
                            </div>
                            <div class="shortcut-keys">
                                <button class="shortcut-key-btn" data-shortcut="zoomOut" data-index="0" title="Click to change">‚àí</button>
                                <button class="shortcut-key-btn shortcut-alt" data-shortcut="zoomOut" data-index="1" title="Click to add alternate key"></button>
                            </div>
                        </div>
                        <button id="reset-shortcuts-btn" class="btn btn-secondary" style="margin-top: 12px;">Reset to Defaults</button>
                    </section>

                    <!-- About Section -->
                    <section class="settings-section" data-section="about">
                        <h3>About Yarnl</h3>
                        <p class="section-description">Crochet pattern management app</p>

                        <h4 class="settings-subheading">Library Stats</h4>
                        <div class="library-stats" id="library-stats">
                            <!-- Stats will be populated here -->
                        </div>

                        <h4 class="settings-subheading">App Info</h4>
                        <div class="about-info">
                            <p><strong>Version:</strong> 1.0.0</p>
                            <p><strong>Made with:</strong> Node.js, Express, PostgreSQL</p>
                        </div>

                        <h4 class="settings-subheading">Links</h4>
                        <div class="about-links">
                            <a href="https://github.com/titandrive/yarnl" target="_blank" rel="noopener noreferrer" class="about-link">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
                                </svg>
                                GitHub
                            </a>
                            <a href="https://yarnl.com" target="_blank" rel="noopener noreferrer" class="about-link">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <circle cx="12" cy="12" r="10"></circle>
                                    <line x1="2" y1="12" x2="22" y2="12"></line>
                                    <path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path>
                                </svg>
                                Website
                            </a>
                        </div>
                    </section>
                </div>
            </div>
        </div>

        <!-- PDF Viewer with Counter Overlay (hidden by default, shown when clicking a pattern) -->
        <div id="pdf-viewer-container" class="pdf-viewer-container" style="display: none;">
            <div class="pdf-header">
                <div class="pdf-header-left">
                    <button id="pdf-back-btn" class="btn btn-secondary">‚Üê Back</button>
                    <button id="pdf-notes-btn" class="btn btn-secondary">Notes</button>
                    <button id="pdf-edit-btn" class="btn btn-secondary">Edit</button>
                    <button id="pdf-info-btn" class="btn btn-secondary">Info</button>
                </div>
                <h2 id="pdf-pattern-name"></h2>
                <div class="pdf-header-right">
                    <div class="timer-control">
                        <button id="pdf-timer-btn" class="btn btn-secondary timer-btn">
                            <svg class="timer-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <circle cx="12" cy="12" r="10"></circle>
                                <polyline points="12 6 12 12 16 14"></polyline>
                            </svg>
                            <span id="pdf-timer-display">0:00:00</span>
                        </button>
                        <button id="pdf-timer-reset-btn" class="btn timer-reset-btn" title="Reset timer">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                                <line x1="18" y1="6" x2="6" y2="18"></line>
                                <line x1="6" y1="6" x2="18" y2="18"></line>
                            </svg>
                        </button>
                    </div>
                    <div class="pdf-nav-controls">
                        <button id="prev-page-btn" class="btn btn-secondary">‚Üê</button>
                        <span id="page-info">Page 1 of 1</span>
                        <button id="next-page-btn" class="btn btn-secondary">‚Üí</button>
                    </div>
                </div>
            </div>

            <div class="pdf-viewer-wrapper">
                <canvas id="pdf-canvas"></canvas>

                <!-- Floating Zoom Controls -->
                <div class="pdf-zoom-overlay">
                    <button id="zoom-fit-btn" class="zoom-btn zoom-fit" title="Fit page to view">Fit</button>
                    <button id="zoom-out-btn" class="zoom-btn" title="Zoom out">‚àí</button>
                    <input type="text" id="zoom-level" value="Fit" title="Enter zoom percentage">
                    <button id="zoom-in-btn" class="zoom-btn" title="Zoom in">+</button>
                    <button id="zoom-100-btn" class="zoom-btn zoom-fit" title="Fit width to screen">Zoom</button>
                </div>
            </div>

            <!-- Counter Overlay at Bottom -->
            <div class="counter-overlay">
                <div id="counters-list" class="counters-list">
                    <!-- Counters will be dynamically added here -->
                </div>
                <div class="counter-actions">
                    <button id="add-counter-btn" class="btn btn-success">+ Add Counter</button>
                </div>
            </div>

            <!-- Notes Popover -->
            <div id="notes-popover" class="notes-popover" style="display: none;">
                <div class="notes-popover-header">
                    <div class="notes-tabs">
                        <button class="notes-tab active" data-tab="edit">Edit</button>
                        <button class="notes-tab" data-tab="preview">Preview</button>
                    </div>
                    <button id="notes-close-btn" class="notes-close">&times;</button>
                </div>
                <div class="notes-popover-body">
                    <textarea id="notes-editor" placeholder="Write your notes here... Markdown supported!"></textarea>
                    <div id="notes-preview" class="notes-preview" style="display: none;"></div>
                </div>
                <div class="notes-popover-footer">
                    <label class="notes-live-preview-label">
                        <input type="checkbox" id="notes-live-preview">
                        <span>Live preview</span>
                    </label>
                    <span id="notes-save-status" class="notes-save-status"></span>
                    <button id="notes-clear-btn" class="btn btn-secondary btn-small">Clear</button>
                </div>
            </div>

            <!-- Edit PDF Pattern Modal -->
            <div id="pdf-edit-modal" class="modal" style="display: none;">
                <div class="modal-content pdf-edit-modal-content">
                    <div class="modal-header">
                        <h2>Edit Pattern</h2>
                        <button class="modal-close" id="close-pdf-edit-modal">&times;</button>
                    </div>
                    <div class="pdf-edit-form">
                        <div class="form-group">
                            <label for="pdf-edit-name">Pattern Name *</label>
                            <input type="text" id="pdf-edit-name" required>
                        </div>
                        <div class="form-group">
                            <label>Category</label>
                            <div id="pdf-edit-category-container">
                                <!-- Category dropdown will be populated dynamically -->
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="pdf-edit-description">Description</label>
                            <textarea id="pdf-edit-description" rows="3" placeholder="Brief description..."></textarea>
                        </div>
                        <div class="form-group">
                            <label>Hashtags</label>
                            <div id="pdf-edit-hashtags-container">
                                <!-- Hashtag selector will be populated dynamically -->
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Thumbnail</label>
                            <div class="thumbnail-selector" id="pdf-edit-thumbnail-selector" data-target="pdf-edit">
                                <div class="thumbnail-selector-preview" id="pdf-edit-thumbnail-preview">
                                    <span class="thumbnail-selector-placeholder">+</span>
                                </div>
                            </div>
                            <small class="form-hint">Click to select or paste an image</small>
                        </div>
                    </div>
                    <div class="modal-actions">
                        <button type="button" class="btn btn-secondary" id="cancel-pdf-edit">Cancel</button>
                        <button type="button" class="btn btn-primary" id="save-pdf-edit">Save Changes</button>
                    </div>
                </div>
            </div>

            <!-- Pattern Info Modal -->
            <div id="pattern-info-modal" class="modal" style="display: none;">
                <div class="modal-content pattern-info-modal-content">
                    <div class="modal-header">
                        <h2>Pattern Info</h2>
                        <button class="modal-close" id="close-pattern-info-modal">&times;</button>
                    </div>
                    <div class="pattern-info-content">
                        <div class="info-grid" id="pattern-info-grid">
                            <!-- Info will be populated dynamically -->
                        </div>
                    </div>
                    <div class="modal-actions">
                        <button type="button" class="btn btn-secondary" id="close-pattern-info-btn">Close</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Markdown Pattern Viewer -->
    <div id="markdown-viewer-container" class="markdown-viewer-container" style="display: none;">
        <div class="markdown-header">
            <div class="markdown-header-left">
                <button id="markdown-back-btn" class="btn btn-secondary">‚Üê Back</button>
                <button id="markdown-notes-btn" class="btn btn-secondary">Notes</button>
                <button id="markdown-edit-btn" class="btn btn-secondary">Edit</button>
                <button id="markdown-info-btn" class="btn btn-secondary">Info</button>
            </div>
            <h2 id="markdown-pattern-name"></h2>
            <div class="markdown-header-right">
                <div class="timer-control">
                    <button id="markdown-timer-btn" class="btn btn-secondary timer-btn">
                        <svg class="timer-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="12" cy="12" r="10"></circle>
                            <polyline points="12 6 12 12 16 14"></polyline>
                        </svg>
                        <span id="markdown-timer-display">0:00:00</span>
                    </button>
                    <button id="markdown-timer-reset-btn" class="btn timer-reset-btn" title="Reset timer">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                            <line x1="18" y1="6" x2="6" y2="18"></line>
                            <line x1="6" y1="6" x2="18" y2="18"></line>
                        </svg>
                    </button>
                </div>
            </div>
        </div>

        <div class="markdown-viewer-wrapper">
            <div id="markdown-content" class="markdown-content">
                <!-- Rendered markdown content will go here -->
            </div>
        </div>

        <!-- Counter Overlay at Bottom (same as PDF viewer) -->
        <div class="counter-overlay">
            <div id="markdown-counters-list" class="counters-list">
                <!-- Counters will be dynamically added here -->
            </div>
            <div class="counter-actions">
                <button id="markdown-add-counter-btn" class="btn btn-success">+ Add Counter</button>
            </div>
        </div>

        <!-- Notes Popover (reuse same structure) -->
        <div id="markdown-notes-popover" class="notes-popover" style="display: none;">
            <div class="notes-popover-header">
                <div class="notes-tabs">
                    <button class="notes-tab active" data-tab="edit">Edit</button>
                    <button class="notes-tab" data-tab="preview">Preview</button>
                </div>
                <button id="markdown-notes-close-btn" class="notes-close">&times;</button>
            </div>
            <div class="notes-popover-body">
                <textarea id="markdown-notes-editor" placeholder="Write your notes here... Markdown supported!"></textarea>
                <div id="markdown-notes-preview" class="notes-preview" style="display: none;"></div>
            </div>
            <div class="notes-popover-footer">
                <label class="notes-live-preview-label">
                    <input type="checkbox" id="markdown-notes-live-preview">
                    <span>Live preview</span>
                </label>
                <span id="markdown-notes-save-status" class="notes-save-status"></span>
                <button id="markdown-notes-clear-btn" class="btn btn-secondary btn-small">Clear</button>
            </div>
        </div>

        <!-- Edit Pattern Content Modal -->
        <div id="markdown-edit-modal" class="modal" style="display: none;">
            <div class="modal-content modal-large">
                <div class="modal-header">
                    <h2>Edit Pattern</h2>
                    <div class="markdown-edit-tabs">
                        <button type="button" class="markdown-edit-tab active" data-tab="edit">Edit</button>
                        <button type="button" class="markdown-edit-tab" data-tab="preview">Preview</button>
                        <label class="markdown-edit-live-preview-label">
                            <input type="checkbox" id="markdown-edit-live-preview">
                            <span>Live preview</span>
                        </label>
                    </div>
                    <button class="modal-close" id="close-markdown-edit-modal">&times;</button>
                </div>
                <div class="markdown-edit-wrapper">
                    <div class="markdown-edit-sidebar">
                        <div class="form-group">
                            <label for="markdown-edit-name">Pattern Name *</label>
                            <input type="text" id="markdown-edit-name" required>
                        </div>
                        <div class="form-group">
                            <label>Category</label>
                            <div id="markdown-edit-category-container">
                                <!-- Category dropdown will be populated dynamically -->
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="markdown-edit-description">Description</label>
                            <textarea id="markdown-edit-description" rows="2" placeholder="Brief description..."></textarea>
                        </div>
                        <div class="form-group">
                            <label>Hashtags</label>
                            <div id="markdown-edit-hashtags-container">
                                <!-- Hashtag selector will be populated dynamically -->
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Thumbnail</label>
                            <div class="thumbnail-selector" id="markdown-edit-thumbnail-selector" data-target="markdown-edit">
                                <div class="thumbnail-selector-preview" id="markdown-edit-thumbnail-preview">
                                    <span class="thumbnail-selector-placeholder">+</span>
                                </div>
                            </div>
                            <small class="form-hint">Click to select or paste an image</small>
                        </div>
                    </div>
                    <div class="markdown-edit-main">
                        <div class="markdown-edit-body edit-mode">
                            <textarea id="markdown-edit-content" placeholder="Edit pattern content..."></textarea>
                            <div id="markdown-edit-preview" class="markdown-edit-preview"></div>
                        </div>
                    </div>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" id="cancel-markdown-edit">Cancel</button>
                    <button type="button" class="btn btn-primary" id="save-markdown-edit">Save Changes</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Pattern Modal -->
    <div id="edit-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Edit Pattern</h2>
                <button class="modal-close" id="close-edit-modal">&times;</button>
            </div>
            <form id="edit-form">
                <div class="form-group">
                    <label for="edit-pattern-name">Pattern Name *</label>
                    <input type="text" id="edit-pattern-name" required>
                </div>
                <div class="form-group">
                    <label>Category</label>
                    <div id="edit-pattern-category-container">
                        <!-- Category dropdown will be populated dynamically -->
                    </div>
                </div>
                <div class="form-group">
                    <label for="edit-pattern-description">Description</label>
                    <textarea id="edit-pattern-description" rows="3"></textarea>
                </div>
                <div class="form-group">
                    <label>Hashtags</label>
                    <div id="edit-pattern-hashtags-container">
                        <!-- Hashtag selector will be populated dynamically -->
                    </div>
                </div>
                <div class="form-group">
                    <label>Custom Thumbnail (optional)</label>
                    <div class="thumbnail-selector" id="edit-thumbnail-selector" data-target="edit">
                        <div class="thumbnail-selector-preview" id="edit-thumbnail-preview">
                            <span class="thumbnail-selector-placeholder">+</span>
                        </div>
                    </div>
                    <p class="help-text">Click to select or paste an image</p>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" id="cancel-edit-btn">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save Changes</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Thumbnail Selector Modal -->
    <div id="thumbnail-modal" class="modal" style="display: none;">
        <div class="modal-content thumbnail-modal-content">
            <div class="modal-header">
                <h2>Select Thumbnail</h2>
                <button class="modal-close" id="close-thumbnail-modal">&times;</button>
            </div>
            <div class="thumbnail-modal-body">
                <div class="thumbnail-preview-area" id="thumbnail-preview-area">
                    <div class="thumbnail-placeholder" id="thumbnail-placeholder">
                        <span class="thumbnail-placeholder-icon">üñºÔ∏è</span>
                        <p>No image selected</p>
                    </div>
                    <img id="thumbnail-preview-img" class="thumbnail-preview-img" style="display: none;" alt="Thumbnail preview">
                </div>
                <div class="thumbnail-actions">
                    <button type="button" class="btn btn-secondary thumbnail-action-btn" id="thumbnail-browse-btn">
                        <span class="btn-icon">üìÅ</span>
                        <span>Browse Files</span>
                    </button>
                    <button type="button" class="btn btn-secondary thumbnail-action-btn" id="thumbnail-paste-btn">
                        <span class="btn-icon">üìã</span>
                        <span>Paste from Clipboard</span>
                    </button>
                    <input type="file" id="thumbnail-file-input" accept="image/*" hidden>
                </div>
                <p class="thumbnail-hint">You can also paste an image directly (Ctrl+V / Cmd+V)</p>
            </div>
            <div class="modal-actions">
                <button type="button" class="btn btn-secondary" id="thumbnail-clear-btn">Clear</button>
                <button type="button" class="btn btn-secondary" id="cancel-thumbnail-btn">Cancel</button>
                <button type="button" class="btn btn-primary" id="confirm-thumbnail-btn">Use This Image</button>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script src="app.js?v=31"></script>
</body>
</html>
